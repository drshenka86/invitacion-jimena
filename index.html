<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Confirmaciones de Asistencia — Julianchis y Elías FEST</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&family=Parisienne&display=swap" rel="stylesheet">

  <style>
    :root{
      --color-primario:#000;
      --color-secundario:#ffce00;
      --color-terciario:#1a1a1a;
      --color-fondo:#0d0d0d;
      --color-texto:#f1f1f1;
      --color-texto-claro:#c9c9c9;
      --color-borde:#2a2a2a;
      --color-sombra:rgba(255,206,0,0.12);
      --color-boton:#ffce00;
      --color-boton-hover:#e0b800;
      --card-bg:#0d0d0d;
    }

    body{margin:0;font-family:'Montserrat',sans-serif;background:radial-gradient(circle at top left,#1a1a1a 0%,#000 100%);color:var(--color-texto);}
    .container{max-width:1000px;margin:22px auto;padding:18px;}
    h1{color:var(--color-secundario);font-size:20px;margin:0 0 12px 0;text-align:center;}
    .stats{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:14px;}
    .stat-card{background:var(--card-bg);border:1px solid var(--color-borde);border-radius:12px;padding:14px;flex:1;min-width:160px;box-shadow:0 6px 18px var(--color-sombra);}
    .stat-title{font-size:13px;color:var(--color-texto-claro);}
    .stat-value{font-size:20px;color:var(--color-secundario);font-weight:700;}
    .list-card{background:var(--card-bg);border-radius:12px;overflow:hidden;border:1px solid var(--color-borde);}
    .list-header{background:linear-gradient(90deg,#000 0%,#1a1a1a 100%);color:var(--color-secundario);padding:12px 16px;font-weight:700;}
    #confirmacionesList{padding:12px;display:flex;flex-direction:column;gap:10px;max-height:60vh;overflow:auto;}
    .confirm-item{display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;border:1px solid #222;}
    .avatar{width:56px;height:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:#111;color:var(--color-secundario);font-weight:700;}
    .info{flex:1;}
    .name{font-weight:600;font-size:16px;}
    .meta{font-size:13px;color:var(--color-texto-claro);}
    .right{text-align:right;}
    footer{text-align:center;color:var(--color-texto-claro);font-size:13px;margin-top:16px;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Confirmaciones — Julianchis y Elías FEST</h1>

    <section class="stats">
      <div class="stat-card">
        <div class="stat-title">Total Confirmaciones</div>
        <div class="stat-value" id="totalConfirmaciones">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-title">Adultos Totales</div>
        <div class="stat-value" id="totalAdultos">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-title">Niños Totales</div>
        <div class="stat-value" id="totalNinos">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-title">Total Personas</div>
        <div class="stat-value" id="totalPersonas">0</div>
      </div>
    </section>

    <section class="list-card">
      <div class="list-header">Lista de Confirmaciones</div>
      <div id="confirmacionesList"></div>
    </section>

    <footer>Versión <strong>1.0.10</strong> — <time id="fechaPublicacion"></time></footer>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey:"AIzaSyAG1fFh_ZwN4hSYe-1v-yxqsW4WWjyjkl4",
      authDomain:"confirmaciones-jimena.firebaseapp.com",
      projectId:"confirmaciones-jimena"
    };
    firebase.initializeApp(firebaseConfig);
    const db=firebase.firestore();

    function calcularPersonas(d){
      const adultos=Number(d.adultos||0);
      const ninos=Number(d.ninos||0);
      return {adultos,ninos,total:adultos+ninos};
    }

    function formatFecha(ts){
      if(!ts)return'—';
      const d=ts.toDate?ts.toDate():new Date(ts);
      return d.toLocaleString('es-MX',{day:'2-digit',month:'short',year:'numeric',hour:'2-digit',minute:'2-digit'});
    }

    function renderLista(data){
      const list=document.getElementById("confirmacionesList");
      list.innerHTML='';
      let totalConfirm=0,totalPersonas=0,totalAdultos=0,totalNinos=0;
      data.forEach(d=>{
        const {adultos,ninos,total}=calcularPersonas(d);
        totalConfirm++;totalAdultos+=adultos;totalNinos+=ninos;totalPersonas+=total;
        const div=document.createElement('div');
        div.className='confirm-item';
        div.innerHTML=`
          <div class="avatar">${(d.nombre||'?').charAt(0).toUpperCase()}</div>
          <div class="info">
            <div class="name">${d.nombre||'Sin nombre'}</div>
            <div class="meta">Adultos: <b>${adultos}</b> • Niños: <b>${ninos}</b><br>${formatFecha(d.timestamp)}</div>
          </div>
          <div class="right"><div><b>${total}</b></div><div style="font-size:12px;color:var(--color-texto-claro)">Total</div></div>`;
        list.appendChild(div);
      });
      document.getElementById("totalConfirmaciones").textContent=totalConfirm;
      document.getElementById("totalAdultos").textContent=totalAdultos;
      document.getElementById("totalNinos").textContent=totalNinos;
      document.getElementById("totalPersonas").textContent=totalPersonas;
    }

    db.collection("confirmaciones").orderBy("timestamp","desc").onSnapshot(s=>{
      const docs=s.docs.map(d=>d.data());
      renderLista(docs);
    });

    // footer con fecha
    document.getElementById('fechaPublicacion').textContent=new Date().toLocaleString('es-MX',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});
  </script>
</body>
</html>
